<link rel="import" href="../../../base/polymer/polymer.html">
<link rel="import" href="../../../base/core-ajax/core-xhr.html">

<polymer-element name="login-auth" attributes="authenticate authToken">
	<template>
		<core-xhr id="xhr"></core-xhr>
	</template>
	
	<script>
	Polymer({
		created: function() {
			this.username = null;
			this.password = null;
			this.authToken = null;
		},
		authenticate: function(username, password, onSuccess) {
			var xhr = this.$.xhr.request({
				url: 'http://localhost:8000/samples/endpoints/auth.json',
				params: {username:username, password:password}
			});
			xhr.onreadystatechange = function() {
				if (xhr.readyState == 4 && xhr.responseText) {
					var response = JSON.parse(xhr.responseText);
					if (response.auth_token) {
						this.authToken = response.auth_token;
						onSuccess();
						
						// TODO: Write auth token to local storage.
					}
				}
			}
		}
	});
	</script>
</polymer-element>